



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
        <meta name="description" content="Kotlin Reactive Workflows">
      
      
      
        <meta name="author" content="Jason Brooks">
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.0.2">
    
    
      
        <title>Workflow Basics - Krews</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.982221ab.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.224b79ff.css">
      
      
        
        
        <meta name="theme-color" content="#546e7a">
      
    
    
      <script src="../assets/javascripts/modernizr.1f0bcf2b.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700|Roboto+Mono">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../assets/fonts/material-icons.css">
    
    
      <link rel="stylesheet" href="../css/extra.css">
    
    
      
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="blue-grey" data-md-color-accent="amber">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448"
    viewBox="0 0 416 448" id="__github">
  <path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19-18.125
        8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19 18.125-8.5
        18.125 8.5 10.75 19 3.125 20.5zM320 304q0 10-3.125 20.5t-10.75
        19-18.125 8.5-18.125-8.5-10.75-19-3.125-20.5 3.125-20.5 10.75-19
        18.125-8.5 18.125 8.5 10.75 19 3.125 20.5zM360
        304q0-30-17.25-51t-46.75-21q-10.25 0-48.75 5.25-17.75 2.75-39.25
        2.75t-39.25-2.75q-38-5.25-48.75-5.25-29.5 0-46.75 21t-17.25 51q0 22 8
        38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0
        37.25-1.75t35-7.375 30.5-15 20.25-25.75 8-38.375zM416 260q0 51.75-15.25
        82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5-41.75
        1.125q-19.5 0-35.5-0.75t-36.875-3.125-38.125-7.5-34.25-12.875-30.25-20.25-21.5-28.75q-15.5-30.75-15.5-82.75
        0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25
        30.875q36.75-8.75 77.25-8.75 37 0 70 8 26.25-20.5
        46.75-30.25t47.25-9.75q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34
        99.5z" />
</svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#workflows" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="Krews" class="md-header-nav__button md-logo">
          
            <img src="../img/krews_logo_white.png" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Krews
            </span>
            <span class="md-header-nav__topic">
              Workflow Basics
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/weng-lab/krews/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    krews
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href=".." title="Krews" class="md-nav__button md-logo">
      
        <img src="../img/krews_logo_white.png" width="48" height="48">
      
    </a>
    Krews
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/weng-lab/krews/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    krews
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Why Krews?
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Why Krews?
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../why_krews/" title="Tooling" class="md-nav__link">
      Tooling
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../why_krews/#clean-concise-powerful" title="Clean, Concise, and Powerful" class="md-nav__link">
      Clean, Concise, and Powerful
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../why_krews/#docker-native" title="Docker Native" class="md-nav__link">
      Docker Native
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../why_krews/#cloud-native" title="Cloud Native" class="md-nav__link">
      Cloud Native
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Getting Started
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Getting Started
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../getting_started/" title="Using the Boilerplate (Recommended)" class="md-nav__link">
      Using the Boilerplate (Recommended)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../getting_started/#creating-a-project-from-scratch" title="From Scratch" class="md-nav__link">
      From Scratch
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Docker
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        Docker
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/" title="How Krews uses Docker" class="md-nav__link">
      How Krews uses Docker
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../docker/#what-about-singularity" title="What about Singularity" class="md-nav__link">
      What about Singularity
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Reactor
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        Reactor
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../reactor/" title="Publishers, Fluxes, and Monos" class="md-nav__link">
      Publishers, Fluxes, and Monos
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reactor/#flux-and-mono-creation" title="Flux and Mono Creation" class="md-nav__link">
      Flux and Mono Creation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../reactor/#operations" title="Operations" class="md-nav__link">
      Operations
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Workflows
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        Workflows
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Workflow Basics
      </label>
    
    <a href="./" title="Workflow Basics" class="md-nav__link md-nav__link--active">
      Workflow Basics
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tasks" title="Tasks" class="md-nav__link">
    Tasks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-inputs-and-outputs" title="Task Inputs and Outputs" class="md-nav__link">
    Task Inputs and Outputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-definitions" title="Task Definitions" class="md-nav__link">
    Task Definitions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" title="Files" class="md-nav__link">
    Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-paths" title="File Paths" class="md-nav__link">
    File Paths
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-files" title="Input Files" class="md-nav__link">
    Input Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-files" title="Output Files" class="md-nav__link">
    Output Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#params" title="Params" class="md-nav__link">
    Params
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-organization" title="Code Organization" class="md-nav__link">
    Code Organization
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="#tasks" title="Tasks" class="md-nav__link">
      Tasks
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="#files" title="Files" class="md-nav__link">
      Files
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="#params" title="Parameters" class="md-nav__link">
      Parameters
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="#code-organization" title="Code Organization" class="md-nav__link">
      Code Organization
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      Running / Environments
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        Running / Environments
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../running_environments/" title="Running" class="md-nav__link">
      Running
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../running_environments/#google" title="Google" class="md-nav__link">
      Google
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../execution_environments/#slurm" title="Slurm" class="md-nav__link">
      Slurm
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../execution_environments/#local-docker" title="Local Docker" class="md-nav__link">
      Local Docker
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Configurations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        Configurations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../config/" title="Configuration Basics" class="md-nav__link">
      Configuration Basics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/#workflow-configurations" title="Workflow Configurations" class="md-nav__link">
      Workflow Configurations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/#task-configurations" title="Task Configurations" class="md-nav__link">
      Task Configurations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../config/#parameters" title="Parameters" class="md-nav__link">
      Parameters
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Output and State
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        Output and State
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../state/" title="Caching" class="md-nav__link">
      Caching
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../state/#state" title="State" class="md-nav__link">
      State
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../state/#reports" title="Reports" class="md-nav__link">
      Reports
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../state/#workflow-output-layout" title="Workflow Output Layout" class="md-nav__link">
      Workflow Output Layout
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tasks" title="Tasks" class="md-nav__link">
    Tasks
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#task-inputs-and-outputs" title="Task Inputs and Outputs" class="md-nav__link">
    Task Inputs and Outputs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#task-definitions" title="Task Definitions" class="md-nav__link">
    Task Definitions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#files" title="Files" class="md-nav__link">
    Files
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#file-paths" title="File Paths" class="md-nav__link">
    File Paths
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#input-files" title="Input Files" class="md-nav__link">
    Input Files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#output-files" title="Output Files" class="md-nav__link">
    Output Files
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#params" title="Params" class="md-nav__link">
    Params
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#code-organization" title="Code Organization" class="md-nav__link">
    Code Organization
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/weng-lab/krews/edit/master/docs/workflows.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="workflows">Workflows<a class="headerlink" href="#workflows" title="Permanent link">&para;</a></h1>
<p>A &ldquo;Workflow&rdquo; is a directed acyclic graph consisting of &ldquo;Tasks&rdquo; glued together with publishers.</p>
<div class="img-container">
    <img src="../img/krews_workflow.png" />
</div>

<p>The following simple example contains two tasks.</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">krews.core.*</span>
<span class="k">import</span> <span class="nn">krews.file.*</span>
<span class="k">import</span> <span class="nn">krews.run</span>
<span class="k">import</span> <span class="nn">reactor.core.publisher.*</span>

<span class="c1">// Bootstrap</span>
<span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">=</span> <span class="n">run</span><span class="p">(</span><span class="n">sampleWorkflow</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

<span class="c1">// The application&#39;s workflow, named &quot;sample-workflow&quot;</span>
<span class="k">val</span> <span class="py">sampleWorkflow</span> <span class="p">=</span> <span class="n">workflow</span><span class="p">(</span><span class="s">&quot;sample-workflow&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// A simple flux of the integers 1 through 10</span>
    <span class="k">val</span> <span class="py">range</span> <span class="p">=</span> <span class="p">(</span><span class="m">1.</span><span class="p">.</span><span class="m">10</span><span class="p">).</span><span class="n">toFlux</span><span class="p">()</span>

    <span class="c1">// A task that creates base64 files</span>
    <span class="k">val</span> <span class="py">base64</span> <span class="p">=</span> <span class="n">task</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">File</span><span class="p">&gt;(</span><span class="s">&quot;base64&quot;</span><span class="p">,</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dockerImage</span> <span class="p">=</span> <span class="s">&quot;alpine:3.8&quot;</span>
        <span class="n">output</span> <span class="p">=</span> <span class="n">OutputFile</span><span class="p">(</span><span class="s">&quot;base64/$input.b64&quot;</span><span class="p">)</span>
        <span class="n">command</span> <span class="p">=</span>
            <span class="s">&quot;&quot;&quot;</span>
            <span class="n">mkdir</span> <span class="p">-</span><span class="n">p</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">base64</span>
            <span class="n">echo</span> <span class="s">&quot;Hello world number $$input!&quot;</span> <span class="p">|</span> <span class="n">base64</span> <span class="p">&gt;</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">base64</span><span class="p">/</span><span class="err">$</span><span class="n">input</span><span class="p">.</span><span class="n">b64</span>
            <span class="s">&quot;&quot;&quot;</span>
    <span class="p">}</span>

    <span class="c1">// A task that zips files</span>
    <span class="n">task</span><span class="p">&lt;</span><span class="n">File</span><span class="p">,</span> <span class="n">File</span><span class="p">&gt;(</span><span class="s">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">base64</span><span class="p">.</span><span class="n">outputPub</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">dockerImage</span> <span class="p">=</span> <span class="s">&quot;alpine:3.8&quot;</span>
        <span class="n">output</span> <span class="p">=</span> <span class="n">OutputFile</span><span class="p">(</span><span class="s">&quot;gzip/${input.filename()}.gz&quot;</span><span class="p">)</span>
        <span class="n">command</span> <span class="p">=</span>
            <span class="s">&quot;&quot;&quot;</span>
            <span class="n">mkdir</span> <span class="p">-</span><span class="n">p</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">gzip</span>
            <span class="n">gzip</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="err">$</span><span class="p">{</span><span class="n">input</span><span class="p">.</span><span class="n">path</span><span class="p">}</span> <span class="p">&gt;</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">gzip</span><span class="p">/</span><span class="err">$</span><span class="p">{</span><span class="n">input</span><span class="p">.</span><span class="n">filename</span><span class="p">()}.</span><span class="n">gz</span>
            <span class="s">&quot;&quot;&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<p>Let&rsquo;s break this down. </p>
<p>The <code>main</code> function is the application entrypoint. All it does is call the Krews <code>run</code> function
which does all the heavy lifting, parsing command line arguments and running the application with different 
configurations. More on that <a href="../running_environments/">later</a>.</p>
<h2 id="tasks">Tasks<a class="headerlink" href="#tasks" title="Permanent link">&para;</a></h2>
<p>Tasks are objects that handle processing data using docker containers. They have an input publisher and 
output publisher. The Input publisher may be a Mono or Flux, but the output publisher is always a Flux.</p>
<p>If you read the Project Reactor Documentation, you may have noticed most operations described in terms of 
marble diagrams (See <a href="https://projectreactor.io/docs/core/release/api/reactor/core/publisher/Flux.html">Flux</a> docs
for examples). Tasks can be conceptualized in a similar way.</p>
<div class="img-container">
    <img src="../img/krews_task.png" />
</div>

<p>Tasks operate on every item from an input publisher, process them, and turn them into outputs for the output flux.</p>
<p>Let&rsquo;s take another look at the tasks from the above workflow.
<div class="codehilite"><pre><span></span>    <span class="k">val</span> <span class="py">base64</span> <span class="p">=</span> <span class="n">task</span><span class="p">&lt;</span><span class="n">Int</span><span class="p">,</span> <span class="n">File</span><span class="p">&gt;(</span><span class="s">&quot;base64&quot;</span><span class="p">,</span> <span class="n">range</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Everything in this scope is calculated per-input </span>
        <span class="n">dockerImage</span> <span class="p">=</span> <span class="s">&quot;alpine:3.8&quot;</span>
        <span class="n">output</span> <span class="p">=</span> <span class="n">OutputFile</span><span class="p">(</span><span class="s">&quot;base64/$input.b64&quot;</span><span class="p">)</span>
        <span class="n">command</span> <span class="p">=</span>
            <span class="s">&quot;&quot;&quot;</span>
            <span class="n">mkdir</span> <span class="p">-</span><span class="n">p</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">base64</span>
            <span class="n">echo</span> <span class="s">&quot;Hello world number $input!&quot;</span> <span class="p">|</span> <span class="n">base64</span> <span class="p">&gt;</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">base64</span><span class="p">/</span><span class="err">$</span><span class="n">input</span><span class="p">.</span><span class="n">b64</span>
            <span class="s">&quot;&quot;&quot;</span>
    <span class="p">}</span>
</pre></div></p>
<h3 id="task-inputs-and-outputs">Task Inputs and Outputs<a class="headerlink" href="#task-inputs-and-outputs" title="Permanent link">&para;</a></h3>
<p>Tasks are declared in Workflows using the <code>task</code> function. This function has two generic fields that we must provide 
with classes (The stuff in &lt;&gt;). The first represents the type of the Input and the second Represents the type 
for the output. These classes may include:</p>
<ul>
<li>Primitive types like Int, String, and Boolean</li>
<li>Krews Files</li>
<li>Collection classes like List, Set, and Map</li>
<li><a href="https://kotlinlang.org/docs/reference/data-classes.html">Data Classes</a></li>
<li>Any combination of the above. For example, List of a data class objects.</li>
</ul>
<p>It&rsquo;s a good idea to always use Data Classes, even if you&rsquo;re only wrapping single Files or values.</p>
<p>More on this below.</p>
<h3 id="task-definitions">Task Definitions<a class="headerlink" href="#task-definitions" title="Permanent link">&para;</a></h3>
<p>Tasks also require 2 fields, the name and the input publisher, and a builder function (everything in {}). 
This function runs for every element provider by the input publisher. This input element is available as the 
variable &ldquo;input&rdquo; in the function.</p>
<p>Within the function, you may set the following fields:</p>
<ul>
<li>dockerImage (Required): The name of the docker image the task will run with.</li>
<li>dockerDataDir: The working directory that should contain input and output files.</li>
<li>output (Required): The output object. (More on this below)</li>
<li>command: The command that will be executed on the given docker image.</li>
<li>env: a map of optional environment variables to run the docker container with.</li>
<li>cpus: number of cpus required for each task run.</li>
<li>memory: amount of memory required for each task run.</li>
<li>diskSize: disk space required for each task run.</li>
<li>time: time required for each task run.</li>
</ul>
<h2 id="files">Files<a class="headerlink" href="#files" title="Permanent link">&para;</a></h2>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Krews Files in this section refer to <code>File</code> classes in the package <code>krews.file</code> NOT <code>java.io</code>. 
Make sure to import accordingly with:
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">krews.file.*</span>
</pre></div></p>
</div>
<p>Krews <code>File</code> objects are references to files that will be moved in and out of containers and File Storage. This 
is accomplished by using them in task Input and Output types. This can happen 3 ways:</p>
<ul>
<li>
<p>as the types directly
<div class="codehilite"><pre><span></span><span class="n">task</span><span class="p">&lt;</span><span class="n">File</span><span class="p">,</span> <span class="n">File</span><span class="p">&gt;(</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</pre></div></p>
</li>
<li>
<p>in Collection Types
<div class="codehilite"><pre><span></span><span class="n">task</span><span class="p">&lt;</span><span class="n">List</span><span class="p">&lt;</span><span class="n">File</span><span class="p">&gt;,</span> <span class="n">Map</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">File</span><span class="p">&gt;&gt;(</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</pre></div></p>
</li>
<li>
<p>as fields in Data Classes
<div class="codehilite"><pre><span></span><span class="k">data</span> <span class="k">class</span> <span class="nc">MyTaskInput</span><span class="p">(</span><span class="n">fileA</span><span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">fileB</span><span class="p">:</span> <span class="n">File</span><span class="p">)</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">MyTaskOutput</span><span class="p">(</span><span class="n">fileX</span><span class="p">:</span> <span class="n">File</span><span class="p">,</span> <span class="n">fileY</span><span class="p">:</span> <span class="n">File</span><span class="p">)</span>

<span class="n">task</span><span class="p">&lt;</span><span class="n">MyTaskInput</span><span class="p">,</span> <span class="n">MyTaskOutput</span><span class="p">&gt;(</span><span class="s">&quot;example&quot;</span><span class="p">,</span> <span class="n">input</span><span class="p">)</span> <span class="p">{</span> <span class="cm">/* ... */</span> <span class="p">}</span>
</pre></div></p>
</li>
</ul>
<p>Again, always using data classes for task inputs and outputs is a good idea.</p>
<h3 id="file-paths">File Paths<a class="headerlink" href="#file-paths" title="Permanent link">&para;</a></h3>
<p>Files contain a <code>path</code> field. This is a partial path (ie. <code>some-dir/file.txt</code>) that can be used to determine real 
file paths as the file gets copied to and from docker containers.</p>
<p>When referencing a file in a task docker container, use the <code>File.dockerPath</code> utility to get the real path inside 
docker. This path will be equal to <code>"${task.dockerDataDir}/${file.path}"</code></p>
<p>Files also contain the following utility functions:</p>
<ul>
<li>parentDir(): gets the parent directory in the File&rsquo;s partial path if one exists. </li>
<li>filename(): gets the filename without parent directories.</li>
<li>filenameNoExt(): gets the filename without extensions</li>
</ul>
<h3 id="input-files">Input Files<a class="headerlink" href="#input-files" title="Permanent link">&para;</a></h3>
<p>In Krews, <code>InputFile</code> is a type of <code>File</code>. They refer to files that were not created by Krews workflows. Passing them
to tasks in input element will trigger copying the file into the task&rsquo;s docker container.</p>
<p>There are several implementation, and you can create your own.</p>
<ul>
<li><code>LocalInputFile</code> refers to files on a locally accessible file system. For use with Local executor and files 
on NFS for Slurm Executor.</li>
<li><code>GSInputFile</code> refers to files in Google Cloud Storage. May be used with any executor as long as the machine 
running the task has permissions to access to it.</li>
</ul>
<p>InputFiles have a <code>cache</code> option that, when set to true, will cause Krews to copy them first to <code>$workingDir/inputs</code>, 
and each task that needs it will copy it from that directory instead of directly from the source. This can be 
useful if you have a type of input file that downloads remote files, from an FTP for example, slowly or with 
limited bandwidth.</p>
<h3 id="output-files">Output Files<a class="headerlink" href="#output-files" title="Permanent link">&para;</a></h3>
<p><code>OutputFile</code> is another implementation of <code>File</code>. These refer to files that are created by the Krews workflow. </p>
<ul>
<li>They live in /outputs in your execution environment&rsquo;s working directory.</li>
<li>Using OutputFiles in task inputs will trigger the file to be copied into the docker container.</li>
<li>Using OutputFiles in task outputs will cause the file to be copied out of the docker container into /outputs. </li>
</ul>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Make sure to create an OutputFile for every file you want to saved. Any file that is not in the output 
object WILL NOT be saved to File Storage. </p>
</div>
<h2 id="params">Params<a class="headerlink" href="#params" title="Permanent link">&para;</a></h2>
<p>Both workflows and tasks contain values that can be passed in from configuration files. We call these &ldquo;Params.&rdquo;</p>
<p>Workflow params are passed into the workflow itself and task params are passed into each task function. 
Task functions run for each input, but the same task params are passed in each time.</p>
<p>Both types of params have a required generic type (again, the stuff in &lt;&gt;&rsquo;s). This type just needs to be able to 
deserialize from our config. It&rsquo;s highly recommended that you use a data class for this as well. See the 
<a href="../config/">configurations page</a> for more on this.</p>
<p>Here&rsquo;s what this looks like on our previous example:</p>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">krews.core.*</span>
<span class="k">import</span> <span class="nn">krews.file.*</span>
<span class="k">import</span> <span class="nn">krews.run</span>
<span class="k">import</span> <span class="nn">reactor.core.publisher.*</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">=</span> <span class="n">run</span><span class="p">(</span><span class="n">sampleWorkflow</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

<span class="c1">// Now we&#39;re using our best practice of data classes for everything</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">SampleParams</span><span class="p">(</span><span class="k">val</span> <span class="py">rangeMax</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span>

<span class="k">data</span> <span class="k">class</span> <span class="nc">Base64Params</span><span class="p">(</span><span class="k">val</span> <span class="py">msg</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">Base64Input</span><span class="p">(</span><span class="k">val</span> <span class="py">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">Base64Output</span><span class="p">(</span><span class="k">val</span> <span class="py">base64File</span><span class="p">:</span> <span class="n">File</span><span class="p">)</span>

<span class="k">data</span> <span class="k">class</span> <span class="nc">ZipParams</span><span class="p">(</span><span class="k">val</span> <span class="py">filenamePrefix</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">ZipInput</span><span class="p">(</span><span class="k">val</span> <span class="py">base64File</span><span class="p">:</span> <span class="n">File</span><span class="p">)</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">ZipOutput</span><span class="p">(</span><span class="k">val</span> <span class="py">zipFile</span><span class="p">:</span> <span class="n">File</span><span class="p">)</span>

<span class="k">val</span> <span class="py">sampleWorkflow</span> <span class="p">=</span> <span class="n">workflow</span><span class="p">(</span><span class="s">&quot;sample-workflow&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Here&#39;s our workflow level params</span>
    <span class="k">val</span> <span class="py">params</span> <span class="p">=</span> <span class="n">params</span><span class="p">&lt;</span><span class="n">SampleParams</span><span class="p">&gt;()</span>

    <span class="k">val</span> <span class="py">base64In</span> <span class="p">=</span> <span class="p">(</span><span class="m">1.</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">rangeMax</span><span class="p">).</span><span class="n">toFlux</span><span class="p">().</span><span class="n">map</span> <span class="p">{</span> <span class="n">Base64Input</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
    <span class="k">val</span> <span class="py">base64</span> <span class="p">=</span> <span class="n">task</span><span class="p">&lt;</span><span class="n">Base64Input</span><span class="p">,</span> <span class="n">Base64Output</span><span class="p">&gt;(</span><span class="s">&quot;base64&quot;</span><span class="p">,</span> <span class="n">base64In</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// and here&#39;s our workflow level params</span>
        <span class="k">val</span> <span class="py">taskParams</span> <span class="p">=</span> <span class="n">taskParams</span><span class="p">&lt;</span><span class="n">Base64Params</span><span class="p">&gt;()</span>

        <span class="n">dockerImage</span> <span class="p">=</span> <span class="s">&quot;alpine:3.8&quot;</span>
        <span class="n">output</span> <span class="p">=</span> <span class="n">Base64Output</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">(</span><span class="s">&quot;base64/${input.index}.b64&quot;</span><span class="p">))</span>
        <span class="n">command</span> <span class="p">=</span>
            <span class="s">&quot;&quot;&quot;</span>
            <span class="n">mkdir</span> <span class="p">-</span><span class="n">p</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">base64</span>
            <span class="n">echo</span> <span class="s">&quot;${taskParams.msg} ${input.index}!&quot;</span> <span class="p">|</span> <span class="n">base64</span> <span class="p">&gt;</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">base64</span><span class="p">/</span><span class="err">$</span><span class="p">{</span><span class="n">input</span><span class="p">.</span><span class="n">index</span><span class="p">}.</span><span class="n">b64</span>
            <span class="s">&quot;&quot;&quot;</span>
    <span class="p">}</span>

    <span class="k">val</span> <span class="py">zipIn</span> <span class="p">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">outputPub</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">ZipInput</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">base64File</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">task</span><span class="p">&lt;</span><span class="n">ZipInput</span><span class="p">,</span> <span class="n">ZipOutput</span><span class="p">&gt;(</span><span class="s">&quot;gzip&quot;</span><span class="p">,</span> <span class="n">zipIn</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">val</span> <span class="py">taskParams</span> <span class="p">=</span> <span class="n">taskParams</span><span class="p">&lt;</span><span class="n">ZipParams</span><span class="p">&gt;()</span>

        <span class="n">dockerImage</span> <span class="p">=</span> <span class="s">&quot;alpine:3.8&quot;</span>
        <span class="n">output</span> <span class="p">=</span> <span class="n">ZipOutput</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">(</span><span class="s">&quot;gzip/${input.base64File.filename()}.gz&quot;</span><span class="p">))</span>
        <span class="n">command</span> <span class="p">=</span>
            <span class="s">&quot;&quot;&quot;</span>
            <span class="n">mkdir</span> <span class="p">-</span><span class="n">p</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">gzip</span>
            <span class="n">gzip</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="err">$</span><span class="p">{</span><span class="n">input</span><span class="p">.</span><span class="n">base64File</span><span class="p">.</span><span class="n">path</span><span class="p">}</span> <span class="p">&gt;</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">gzip</span><span class="p">/</span><span class="err">$</span><span class="p">{</span><span class="n">taskParams</span><span class="p">.</span><span class="n">filenamePrefix</span><span class="p">}-</span><span class="err">$</span><span class="p">{</span><span class="n">input</span><span class="p">.</span><span class="n">base64File</span><span class="p">.</span><span class="n">filename</span><span class="p">()}.</span><span class="n">gz</span>
            <span class="s">&quot;&quot;&quot;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

<h2 id="code-organization">Code Organization<a class="headerlink" href="#code-organization" title="Permanent link">&para;</a></h2>
<p>By now you might be thinking that our workflow is starting to look pretty busy, and as our workflow grows, 
this problem would only get worse.</p>
<p>Because this is an ordinary Kotlin project, we get to split our code up into multiple files. Here&rsquo;s how we 
recommend you do it.</p>
<div class="img-container">
    <img alt="logo" src="../img/krews_code_org.png" />
</div>

<p>Notice we&rsquo;ve broken up our application into a top-level entrypoint file containing our workflow <code>App.kt</code>, and a file for 
each task in the task package.</p>
<p>Let&rsquo;s take a look at one of the tasks first.</p>
<p><strong>task/Base64.kt</strong>
<div class="codehilite"><pre><span></span><span class="k">package</span> <span class="nn">task</span>

<span class="k">import</span> <span class="nn">krews.core.*</span>
<span class="k">import</span> <span class="nn">krews.file.*</span>
<span class="k">import</span> <span class="nn">org.reactivestreams.Publisher</span>

<span class="k">data</span> <span class="k">class</span> <span class="nc">Base64Params</span><span class="p">(</span><span class="k">val</span> <span class="py">msg</span><span class="p">:</span> <span class="n">String</span><span class="p">)</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">Base64Input</span><span class="p">(</span><span class="k">val</span> <span class="py">index</span><span class="p">:</span> <span class="n">Int</span><span class="p">)</span>
<span class="k">data</span> <span class="k">class</span> <span class="nc">Base64Output</span><span class="p">(</span><span class="k">val</span> <span class="py">base64File</span><span class="p">:</span> <span class="n">File</span><span class="p">)</span>

<span class="k">fun</span> <span class="nf">WorkflowBuilder</span><span class="p">.</span><span class="n">base64Task</span><span class="p">(</span><span class="n">i</span><span class="p">:</span> <span class="n">Publisher</span><span class="p">&lt;</span><span class="n">Base64Input</span><span class="p">&gt;)</span> <span class="p">=</span> 
        <span class="k">this</span><span class="p">.</span><span class="n">task</span><span class="p">&lt;</span><span class="n">Base64Input</span><span class="p">,</span> <span class="n">Base64Output</span><span class="p">&gt;(</span><span class="s">&quot;base64&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">taskParams</span> <span class="p">=</span> <span class="n">taskParams</span><span class="p">&lt;</span><span class="n">Base64Params</span><span class="p">&gt;()</span>
    <span class="k">val</span> <span class="py">msg</span> <span class="p">=</span> <span class="n">taskParams</span><span class="p">.</span><span class="n">msg</span>
    <span class="k">val</span> <span class="py">index</span> <span class="p">=</span> <span class="n">input</span><span class="p">.</span><span class="n">index</span>

    <span class="n">dockerImage</span> <span class="p">=</span> <span class="s">&quot;alpine:3.9&quot;</span>
    <span class="n">output</span> <span class="p">=</span> <span class="n">Base64Output</span><span class="p">(</span><span class="n">OutputFile</span><span class="p">(</span><span class="s">&quot;base64/$index.b64&quot;</span><span class="p">))</span>
    <span class="n">command</span> <span class="p">=</span>
        <span class="s">&quot;&quot;&quot;</span>
        <span class="n">mkdir</span> <span class="p">-</span><span class="n">p</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">base64</span>
        <span class="n">echo</span> <span class="s">&quot;$msg $index!&quot;</span> <span class="p">|</span> <span class="n">base64</span> <span class="p">&gt;</span> <span class="p">/</span><span class="k">data</span><span class="p">/</span><span class="n">base64</span><span class="p">/</span><span class="err">$</span><span class="n">index</span><span class="p">.</span><span class="n">b64</span>
        <span class="s">&quot;&quot;&quot;</span>
<span class="p">}</span>
</pre></div></p>
<p>Now all our Base64 task related code is in one place. We&rsquo;ve also used a 
<a href="https://kotlinlang.org/docs/reference/extensions.html">Kotlin Extension Function</a> on a class called WorkflowBuilder 
for our task creation function itself. WorkflowBuilder the class used under-the-hood when you call the &ldquo;workflow&rdquo; 
function. This is just some syntax sugar that allows us to make our workflow look like this:</p>
<p><strong>App.kt</strong>
<div class="codehilite"><pre><span></span><span class="k">import</span> <span class="nn">krews.core.*</span>
<span class="k">import</span> <span class="nn">krews.run</span>
<span class="k">import</span> <span class="nn">reactor.core.publisher.*</span>
<span class="k">import</span> <span class="nn">task.*</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">(</span><span class="n">args</span><span class="p">:</span> <span class="n">Array</span><span class="p">&lt;</span><span class="n">String</span><span class="p">&gt;)</span> <span class="p">=</span> <span class="n">run</span><span class="p">(</span><span class="n">sampleWorkflow</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span>

<span class="k">data</span> <span class="k">class</span> <span class="nc">SampleParams</span><span class="p">(</span>
    <span class="k">val</span> <span class="py">rangeMax</span><span class="p">:</span> <span class="n">Int</span>
<span class="p">)</span>

<span class="k">val</span> <span class="py">sampleWorkflow</span> <span class="p">=</span> <span class="n">workflow</span><span class="p">(</span><span class="s">&quot;sample-workflow&quot;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">val</span> <span class="py">params</span> <span class="p">=</span> <span class="n">params</span><span class="p">&lt;</span><span class="n">SampleParams</span><span class="p">&gt;()</span>

    <span class="k">val</span> <span class="py">base64In</span> <span class="p">=</span> <span class="p">(</span><span class="m">1.</span><span class="p">.</span><span class="n">params</span><span class="p">.</span><span class="n">rangeMax</span><span class="p">).</span><span class="n">toFlux</span><span class="p">().</span><span class="n">map</span> <span class="p">{</span> <span class="n">Base64Input</span><span class="p">(</span><span class="n">it</span><span class="p">)</span> <span class="p">}</span>
    <span class="c1">// Here&#39;s our base64Task call referencing our extension function</span>
    <span class="k">val</span> <span class="py">base64</span> <span class="p">=</span> <span class="n">base64Task</span><span class="p">(</span><span class="n">base64In</span><span class="p">)</span>

    <span class="k">val</span> <span class="py">zipIn</span> <span class="p">=</span> <span class="n">base64</span><span class="p">.</span><span class="n">outputPub</span><span class="p">.</span><span class="n">map</span> <span class="p">{</span> <span class="n">ZipInput</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">base64File</span><span class="p">)</span> <span class="p">}</span>
    <span class="n">zipTask</span><span class="p">(</span><span class="n">zipIn</span><span class="p">)</span>
<span class="p">}</span>
</pre></div></p>
<p>Now our application file is just concerned with a higher level view of the workflow, what tasks are added 
and how they&rsquo;ve been piped together.</p>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../reactor/" title="Publishers, Fluxes, and Monos" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Publishers, Fluxes, and Monos
              </span>
            </div>
          </a>
        
        
          <a href="../running_environments/" title="Running" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Running
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 Weng Lab
          </div>
        
        powered by
        <a href="https://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.d9aa80ab.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:".."}})</script>
      
    
  </body>
</html>